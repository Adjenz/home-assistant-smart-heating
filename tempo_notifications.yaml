alias: "Notifications Tempo Rouge"
description: "Envoie des notifications pour les jours Tempo Rouge"
trigger:
  # Notification la veille d'un jour rouge √† 19h
  - platform: template
    value_template: >
      {{ states('sensor.rte_tempo_prochaine_couleur') == 'ROUGE' and 
         now().strftime('%H:%M') == '19:00' }}
  # Notification le jour m√™me √† 19h
  - platform: template
    value_template: >
      {{ states('sensor.rte_tempo_couleur_actuelle') == 'ROUGE' and 
         now().strftime('%H:%M') == '19:00' }}
action:
  - choose:
      # Cas 1: Notification la veille d'un jour rouge
      - conditions:
          - condition: template
            value_template: "{{ states('sensor.rte_tempo_prochaine_couleur') == 'ROUGE' }}"
        sequence:
          - service: notify.mobile_app_galaxy_s21_fe
            data:
              message: "‚ö†Ô∏è Attention : Demain sera un jour Tempo ROUGE ! Le chauffage sera limit√© pendant les heures pleines (5h45-22h00)."
              title: "Alerte Tempo Rouge - Demain"
              data:
                channel: "tempo_alerts"
                importance: high
                priority: high
      # Cas 2: Notification le jour m√™me √† 19h
      - conditions:
          - condition: template
            value_template: "{{ states('sensor.rte_tempo_couleur_actuelle') == 'ROUGE' }}"
        sequence:
          - service: notify.mobile_app_galaxy_s21_fe
            data:
              message: "üî¥ Rappel : Nous sommes en jour Tempo ROUGE. Le chauffage restera en mode √©conomique jusqu'√† 22h00."
              title: "Rappel Tempo Rouge"
              data:
                channel: "tempo_alerts"
                importance: high
                priority: high
mode: single
